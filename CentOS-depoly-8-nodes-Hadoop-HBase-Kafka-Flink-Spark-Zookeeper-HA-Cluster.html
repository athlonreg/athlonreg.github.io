<!DOCTYPE HTML><html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="keywords" content="Hadoop,HBase,Kafka,Flink,Spark,Zookeeper,HDFS,BigData,大数据"><meta name="description" content="专注优质应用分享与技术经验交流。"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="baidu_union_verify" content="4e839f89679ffccd45aadacf60546450"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-165042084-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-165042084-1")</script><title>CentOS 搭建八节点高可用 Hadoop HBase Kafka Flink Spark Zookeeper 集群 | 套陆的部落阁</title><link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/awesome/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/aos/aos.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/animate/animate.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/css/matery.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/css/my.css"><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/live2d/autoload.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?849cf4fa113bc36fac5697a548d0e27c";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>document.write('<script src="https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba" id="sozz"><\/script>')</script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/jquery/jquery.min.js"></script><script data-ad-client="ca-pub-7406269002228687" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="套陆的部落阁" type="application/atom+xml"><link rel="stylesheet" href="/css/prism-tomorrow.css"><link rel="stylesheet" href="/css/prism-line-numbers.css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/favicon.ico" class="logo-img" alt="LOGO"> <span class="logo-span">套陆的部落阁</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/artitalk" class="waves-effect waves-light"><i class="fas fa-comment-o" style="zoom:.6"></i> <span>ShuoShuo</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/bb" class="waves-effect waves-light"><i class="fas fa-commenting" style="zoom:.6"></i> <span>BB</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/favicon.ico" class="logo-img circle responsive-img"><div class="logo-name">套陆的部落阁</div><div class="logo-desc">专注优质应用分享与技术经验交流。</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/artitalk" class="waves-effect waves-light"><i class="fa-fw fas fa-comment-o"></i> ShuoShuo</a></li><li class="m-nav-item"><a href="/bb" class="waves-effect waves-light"><i class="fa-fw fas fa-commenting"></i> BB</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li><div class="divider"></div></li><li><a href="https://github.com/athlonreg" rel="external nofollow noreferrer" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/athlonreg" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/cryptojs/crypto-js.min.js"></script><script>(function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();</script><div class="bg-cover pd-header post-cover" style="background-image:url(https://cdn.jsdelivr.net/gh/tlhub/1/hadoop.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">CentOS 搭建八节点高可用 Hadoop HBase Kafka Flink Spark Zookeeper 集群</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{padding:35px 0 15px 17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{padding-bottom:30px;overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:25px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Hadoop/"><span class="chip bg-color">Hadoop</span></a> <a href="/tags/HBase/"><span class="chip bg-color">HBase</span></a> <a href="/tags/Kafka/"><span class="chip bg-color">Kafka</span></a> <a href="/tags/Flink/"><span class="chip bg-color">Flink</span></a> <a href="/tags/Spark/"><span class="chip bg-color">Spark</span></a> <a href="/tags/Zookeeper/"><span class="chip bg-color">Zookeeper</span></a> <a href="/tags/HDFS/"><span class="chip bg-color">HDFS</span></a> <a href="/tags/BigData/"><span class="chip bg-color">BigData</span></a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="chip bg-color">大数据</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Linux/" class="post-category">Linux</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2020-10-03</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i> 更新日期:&nbsp;&nbsp; 2020-10-03</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 5.9k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 30 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i> 阅读次数:&nbsp;&nbsp;<span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><style>code[class*=language-],pre[class*=language-]{white-space:pre-wrap!important}</style><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block;text-align:center" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7406269002228687" data-ad-slot="6237413824"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div class="card-content article-card-content"><div id="articleContent"><h2 id="版本选择"><a href="#版本选择" class="headerlink" title="版本选择"></a>版本选择</h2><table><thead><tr><th>组件</th><th>版本</th></tr></thead><tbody><tr><td>JDK</td><td>1.8.0_261</td></tr><tr><td>Zookeeper</td><td>3.5.8</td></tr><tr><td>Hadoop</td><td>3.2.1</td></tr><tr><td>HBase</td><td>2.2.5</td></tr><tr><td>Spark</td><td>3.0.1-hadoop_3.2</td></tr><tr><td>Kafka</td><td>2.6.0-scala_2.13</td></tr><tr><td>Flink</td><td>1.11.2-scala_2.12</td></tr><tr><td>flink-shaded-hadoop-3-uber</td><td>3.1.1.7.1.1.0-565-9.0</td></tr></tbody></table><h2 id="基础环境部署"><a href="#基础环境部署" class="headerlink" title="基础环境部署"></a>基础环境部署</h2><h3 id="服务器规划"><a href="#服务器规划" class="headerlink" title="服务器规划"></a>服务器规划</h3><p><strong><em>共计 8 台分布式存储服务器</em></strong></p><blockquote><p>ZK 集群高可用需要奇数个节点，这里用 5 节点部署 ZK 高可用集群</p><p>hadoop 集群高可用集群使用 8 个节点</p><pre><code>NameNode 一主(hadoop001)三备(hadoop002、hadoop003、hadoop004)
ResourceManager 一主(hadoop002)三备(hadoop003、hadoop004、hadoop005)
JournalNode 使用 7 个节点(hadoop001-007)</code></pre></blockquote><pre><code>hadoop001: zookeeper、hadoop、主NameNode、DFSZKFailoverController、DataNode、JournalNode、NodeManager
hadoop002: zookeeper、hadoop、备NameNode、DFSZKFailoverController、主ResourceManager、DataNode、JournalNode、NodeManager
hadoop003: zookeeper、hadoop、备NameNode、备ResourceManager、DataNode、JournalNode、NodeManager
hadoop004: zookeeper、hadoop、备NameNode、备ResourceManager、DataNode、JournalNode、NodeManager
hadoop005: zookeeper、hadoop、备ResourceManager、DataNode、JournalNode、NodeManager
hadoop006: hadoop、DataNode、JournalNode、NodeManager
hadoop007: hadoop、DataNode、JournalNode、NodeManager
hadoop008: hadoop、DataNode、NodeManager</code></pre><h3 id="防火墙配置-all-nodes"><a href="#防火墙配置-all-nodes" class="headerlink" title="防火墙配置(all nodes)"></a>防火墙配置(all nodes)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># sed -i -e "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/selinux/config</span>
<span class="token comment" spellcheck="true"># systemctl stop firewalld</span>
<span class="token comment" spellcheck="true"># systemctl disable firewalld</span>
<span class="token comment" spellcheck="true"># setenforce 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="通用工具安装-all-nodes"><a href="#通用工具安装-all-nodes" class="headerlink" title="通用工具安装(all nodes)"></a>通用工具安装(all nodes)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># yum -y install wget tree vim unzip zlib zip net-tools lsof telnet dos2unix ntfs-3g pcre gcc-c++ openssl pcre-devel yum-utils</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="hosts-准备-all-nodes"><a href="#hosts-准备-all-nodes" class="headerlink" title="hosts 准备(all nodes)"></a>hosts 准备(all nodes)</h3><blockquote><p>所有集群节点</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># echo '</span>
192.168.2.11   hadoop001
192.168.2.12   hadoop002
192.168.2.13   hadoop003
192.168.2.14   hadoop004
192.168.2.15   hadoop005
192.168.2.16   hadoop006
192.168.2.17   hadoop007
192.168.2.18   hadoop008' <span class="token operator">></span> /etc/hosts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="免密登录配置"><a href="#免密登录配置" class="headerlink" title="免密登录配置"></a>免密登录配置</h3><blockquote><p>第一个节点即主节点生成密钥(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh-keygen -t rsa</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>将 hadoop001 的公钥写到本机和远程机器的 ~/ .ssh/authorized_key 文件中(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop001</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop002</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop003</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop004</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop005</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop006</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop007</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>验证免密登录(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh hadoop001</span>
<span class="token comment" spellcheck="true"># ssh hadoop002</span>
<span class="token comment" spellcheck="true"># ssh hadoop003</span>
<span class="token comment" spellcheck="true"># ssh hadoop004</span>
<span class="token comment" spellcheck="true"># ssh hadoop005</span>
<span class="token comment" spellcheck="true"># ssh hadoop006</span>
<span class="token comment" spellcheck="true"># ssh hadoop007</span>
<span class="token comment" spellcheck="true"># ssh hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="yum-优化-hadoop001"><a href="#yum-优化-hadoop001" class="headerlink" title="yum 优化(hadoop001)"></a>yum 优化(hadoop001)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cd /etc/yum.repos.d</span>
<span class="token comment" spellcheck="true"># mkdir bak &amp;&amp; mv *.repo bak/</span>
<span class="token comment" spellcheck="true"># curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span>
<span class="token comment" spellcheck="true"># curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>分发</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># scp -rf /etc/yum.repos.d root@hadoop002:/etc/</span>
<span class="token comment" spellcheck="true"># scp -r /etc/yum.repos.d root@hadoop003:/etc/</span>
<span class="token comment" spellcheck="true"># scp -r /etc/yum.repos.d root@hadoop004:/etc/</span>
<span class="token comment" spellcheck="true"># scp -r /etc/yum.repos.d root@hadoop005:/etc/</span>
<span class="token comment" spellcheck="true"># scp -r /etc/yum.repos.d root@hadoop006:/etc/</span>
<span class="token comment" spellcheck="true"># scp -r /etc/yum.repos.d root@hadoop007:/etc/</span>
<span class="token comment" spellcheck="true"># scp -r /etc/yum.repos.d root@hadoop008:/etc/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h3><blockquote><p>ntpdata(all nodes)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># yum -y install ntpdate</span>
<span class="token comment" spellcheck="true"># ntpdate ntp1.aliyun.com</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Java-运行环境部署-hadoop001"><a href="#Java-运行环境部署-hadoop001" class="headerlink" title="Java 运行环境部署(hadoop001)"></a>Java 运行环境部署(hadoop001)</h3><blockquote><p>解压安装(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mkdir /usr/java</span>
<span class="token comment" spellcheck="true"># tar zxvf jdk-8u261-linux-x64.tar.gz -C /usr/java</span>
<span class="token comment" spellcheck="true"># echo '# Java Env</span>
<span class="token function">export</span> JAVA_HOME<span class="token operator">=</span>/usr/java/jdk1.8.0_261
<span class="token function">export</span> CLASSPATH<span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools/jar
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$PATH</span><span class="token keyword">:</span><span class="token variable">$JAVA_HOME</span>/bin' <span class="token operator">>></span> /etc/profile
<span class="token comment" spellcheck="true"># source /etc/profile</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>分发至其它节点</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># scp -r /usr/java root@hadoop002:/usr/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/java root@hadoop003:/usr/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/java root@hadoop004:/usr/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/java root@hadoop005:/usr/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/java root@hadoop006:/usr/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/java root@hadoop007:/usr/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/java root@hadoop008:/usr/</span>

<span class="token comment" spellcheck="true"># scp /etc/profile root@hadoop002:/etc/profile</span>
<span class="token comment" spellcheck="true"># scp /etc/profile root@hadoop003:/etc/profile</span>
<span class="token comment" spellcheck="true"># scp /etc/profile root@hadoop004:/etc/profile</span>
<span class="token comment" spellcheck="true"># scp /etc/profile root@hadoop005:/etc/profile</span>
<span class="token comment" spellcheck="true"># scp /etc/profile root@hadoop006:/etc/profile</span>
<span class="token comment" spellcheck="true"># scp /etc/profile root@hadoop007:/etc/profile</span>
<span class="token comment" spellcheck="true"># scp /etc/profile root@hadoop008:/etc/profile</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Zookeeper-高可用集群搭建"><a href="#Zookeeper-高可用集群搭建" class="headerlink" title="Zookeeper 高可用集群搭建"></a>Zookeeper 高可用集群搭建</h2><h3 id="下载安装-usr-local-hadoop001"><a href="#下载安装-usr-local-hadoop001" class="headerlink" title="下载安装 (/usr/local) (hadoop001)"></a>下载安装 (/usr/local) (hadoop001)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cd /usr/local</span>
<span class="token comment" spellcheck="true"># wget https://mirrors.ustc.edu.cn/apache/zookeeper/stable/apache-zookeeper-3.5.8-bin.tar.gz</span>
<span class="token comment" spellcheck="true"># tar zxvf apache-zookeeper-3.5.8-bin.tar.gz</span>
<span class="token comment" spellcheck="true"># mv apache-zookeeper-3.5.8-bin zookeeper</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="主节点修改配置-hadoop001"><a href="#主节点修改配置-hadoop001" class="headerlink" title="主节点修改配置(hadoop001)"></a>主节点修改配置(hadoop001)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cp /usr/local/zookeeper/conf/zoo_sample.cfg /usr/local/zookeeper/conf/zoo.cfg</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>/usr/local/zookeeper/conf/zoo.cfg</p></blockquote><pre><code>maxClientCnxns=0
tickTime=2000
initLimit=10
syncLimit=5
dataDir=/usr/local/zookeeper/data
dataLogDir=/usr/local/zookeeper/log
clientPort=2181

# server.1 这个1是服务器的标识，可以是任意有效数字，标识这是第几个服务器节点，这个标识要写到dataDir目录下面myid文件里
# 指名集群间通讯端口和选举端口
server.1=hadoop001:2888:3888
server.2=hadoop002:2888:3888
server.3=hadoop003:2888:3888
server.4=hadoop004:2888:3888
server.5=hadoop005:2888:3888</code></pre><blockquote><p>创建数据存储目录和日志目录</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mkdir -p /usr/local/zookeeper/{data,log}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>分发至其它节点</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper root@hadoop002:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper root@hadoop003:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper root@hadoop004:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper root@hadoop005:/usr/local/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>写入节点标识(所有 ZK 节点执行)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## hadoop001 主机执行</span>
<span class="token comment" spellcheck="true"># echo "1" > /usr/local/zookeeper/data/myid</span>
<span class="token comment" spellcheck="true">## hadoop002 主机执行</span>
<span class="token comment" spellcheck="true"># echo "2" > /usr/local/zookeeper/data/myid</span>
<span class="token comment" spellcheck="true">## hadoop003 主机执行</span>
<span class="token comment" spellcheck="true"># echo "3" > /usr/local/zookeeper/data/myid</span>
<span class="token comment" spellcheck="true">## hadoop004 主机执行</span>
<span class="token comment" spellcheck="true"># echo "4" > /usr/local/zookeeper/data/myid</span>
<span class="token comment" spellcheck="true">## hadoop005 主机执行</span>
<span class="token comment" spellcheck="true"># echo "5" > /usr/local/zookeeper/data/myid</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>配置环境变量</p></blockquote><p><em>所有 ZK 节点均需配置</em></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># echo '</span>
<span class="token function">export</span> ZOOKEEPER_HOME<span class="token operator">=</span>/usr/local/zookeeper
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$PATH</span><span class="token keyword">:</span><span class="token variable">$ZOOKEEPER_HOME</span>/bin' <span class="token operator">>></span> /etc/profile
<span class="token function">source</span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h3><blockquote><p>分别在 5 台主机上，执行如下命令启动服务：</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># zkServer.sh start</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>各个 ZK 节点使用如下命令查看状态</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@hadoop001 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /usr/local/zookeeper/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: 2181. Client address: localhost.
Mode: follower
<span class="token punctuation">[</span>root@hadoop001 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@hadoop002 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /usr/local/zookeeper/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: 2181. Client address: localhost.
Mode: follower
<span class="token punctuation">[</span>root@hadoop002 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@hadoop003 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /usr/local/zookeeper/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: 2181. Client address: localhost.
Mode: leader
<span class="token punctuation">[</span>root@hadoop003 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@hadoop004 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /usr/local/zookeeper/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: 2181. Client address: localhost.
Mode: follower
<span class="token punctuation">[</span>root@hadoop004 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@hadoop005 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /usr/local/zookeeper/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: 2181. Client address: localhost.
Mode: follower
<span class="token punctuation">[</span>root@hadoop005 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Hadoop-高可用集群搭建"><a href="#Hadoop-高可用集群搭建" class="headerlink" title="Hadoop 高可用集群搭建"></a>Hadoop 高可用集群搭建</h2><blockquote><p>Hadoop 高可用 (High Availability) 分为 HDFS 高可用和 YARN 高可用，两者的实现基本类似，但 HDFS NameNode 对数据存储及其一致性的要求比 YARN ResourceManger 高得多，所以它的实现也更加复杂。</p></blockquote><p>HDFS 高可用架构主要由以下组件所构成：</p><p><strong>Active NameNode</strong> 和 <strong>Standby NameNode</strong>：两台 NameNode 形成互备，一台处于 Active 状态，为主 NameNode，另外一台处于 Standby 状态，为备 NameNode，只有主 NameNode 才能对外提供读写服务。</p><p><strong>主备切换控制器 ZKFailoverController</strong>：ZKFailoverController 作为独立的进程运行，对 NameNode 的主备切换进行总体控制。ZKFailoverController 能及时检测到 NameNode 的健康状况，在主 NameNode 故障时借助 Zookeeper 实现自动的主备选举和切换，当然 NameNode 目前也支持不依赖于 Zookeeper 的手动主备切换。</p><p><strong>Zookeeper 集群</strong>：为主备切换控制器提供主备选举支持。</p><p><strong>共享存储系统</strong>：共享存储系统是实现 NameNode 的高可用最为关键的部分，共享存储系统保存了 NameNode 在运行过程中所产生的 HDFS 的元数据。主 NameNode 和 NameNode 通过共享存储系统实现元数据同步。在进行主备切换的时候，新的主 NameNode 在确认元数据完全同步之后才能继续对外提供服务。</p><p><strong>DataNode 节点</strong>：除了通过共享存储系统共享 HDFS 的元数据信息之外，主 NameNode 和备 NameNode 还需要共享 HDFS 的数据块和 DataNode 之间的映射关系。DataNode 会同时向主 NameNode 和备 NameNode 上报数据块的位置信息。</p><h3 id="Hadoop-主节点免密登录配置"><a href="#Hadoop-主节点免密登录配置" class="headerlink" title="Hadoop 主节点免密登录配置"></a>Hadoop 主节点免密登录配置</h3><blockquote><p>NameNode 主节点生成密钥(hadoop002)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh-keygen -t rsa</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>将 hadoop002 的公钥写到本机和远程机器的 ~/ .ssh/authorized_key 文件中(hadoop002)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop001</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop002</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop003</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop004</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop005</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop006</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop007</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>验证免密登录(hadoop002)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh hadoop001</span>
<span class="token comment" spellcheck="true"># ssh hadoop002</span>
<span class="token comment" spellcheck="true"># ssh hadoop003</span>
<span class="token comment" spellcheck="true"># ssh hadoop004</span>
<span class="token comment" spellcheck="true"># ssh hadoop005</span>
<span class="token comment" spellcheck="true"># ssh hadoop006</span>
<span class="token comment" spellcheck="true"># ssh hadoop007</span>
<span class="token comment" spellcheck="true"># ssh hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="解压安装-hadoop001"><a href="#解压安装-hadoop001" class="headerlink" title="解压安装(hadoop001)"></a>解压安装(hadoop001)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># tar zxvf hadoop-3.2.1.tar.gz -C /usr/local</span>
<span class="token comment" spellcheck="true"># cd /usr/local &amp;&amp; mv hadoop-3.2.1 hadoop</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="配置环境变量-所有-hadoop-节点"><a href="#配置环境变量-所有-hadoop-节点" class="headerlink" title="配置环境变量(所有 hadoop 节点)"></a>配置环境变量(所有 hadoop 节点)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># echo '</span>
<span class="token function">export</span> HADOOP_HOME<span class="token operator">=</span>/usr/local/hadoop
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$PATH</span><span class="token keyword">:</span><span class="token variable">$HADOOP_HOME</span>/sbin:<span class="token variable">$HADOOP_HOME</span>/bin' <span class="token operator">>></span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="配置-Hadoop-hadoop001"><a href="#配置-Hadoop-hadoop001" class="headerlink" title="配置 Hadoop (hadoop001)"></a>配置 Hadoop (hadoop001)</h3><blockquote><p>${HADOOP_HOME}/etc/hadoop/hadoop-env.sh</p></blockquote><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">export</span> <span class="token attr-value">JAVA_HOME=/usr/java/jdk1.8.0_261</span>
<span class="token attr-name">export</span> <span class="token attr-value">HDFS_NAMENODE_USER=root</span>
<span class="token attr-name">export</span> <span class="token attr-value">HDFS_DATANODE_USER=root</span>
<span class="token attr-name">export</span> <span class="token attr-value">HDFS_ZKFC_USER=root</span>
<span class="token attr-name">export</span> <span class="token attr-value">HDFS_JOURNALNODE_USER=root</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>${HADOOP_HOME}/etc/hadoop/yarn-env.sh</p></blockquote><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">export</span> <span class="token attr-value">YARN_RESOURCEMANAGER_USER=root</span>
<span class="token attr-name">export</span> <span class="token attr-value">HADOOP_SECURE_DN_USER=yarn</span>
<span class="token attr-name">export</span> <span class="token attr-value">YARN_NODEMANAGER_USER=root</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>${HADOOP_HOME}/etc/hadoop/core-site.xml</p></blockquote><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 指定 namenode 的 hdfs 协议文件系统的通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hdfs://hdfscluster:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 指定 hadoop 集群存储临时文件的目录 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hadoop.tmp.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/home/hadoop/tmp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 用户角色配置，不配置此项会导致 web 页面报错 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hadoop.http.staticuser.user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- ZooKeeper 集群的地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>ha.zookeeper.quorum<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop001:2181,hadoop002:2181,hadoop003:2181,hadoop004:2181,hadoop005:2181<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>创建 hadoop 集群存储临时文件的目录</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mkdir -p /home/hadoop/tmp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>${HADOOP_HOME}/etc/hadoop/hdfs-site.xml</p></blockquote><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 指定 HDFS 副本的数量 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.replication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- namenode 节点数据（即元数据）的存放位置，可以指定多个目录实现容错，多个目录用逗号分隔 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.name.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/home/hadoop/namenode/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- datanode 节点数据（即数据块）的存放位置 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.datanode.data.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/home/hadoop/datanode/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 集群服务的逻辑名称 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.nameservices<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hdfscluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- NameNode ID 列表--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.namenodes.hdfscluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>nn1,nn2,nn3,nn4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- nn1 的 RPC 通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.rpc-address.hdfscluster.nn1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop001:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- nn2 的 RPC 通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.rpc-address.hdfscluster.nn2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop002:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- nn3 的 RPC 通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.rpc-address.hdfscluster.nn3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop003:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- nn4 的 RPC 通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.rpc-address.hdfscluster.nn4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop004:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- nn1 的 http 通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.http-address.hdfscluster.nn1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop001:9870<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- nn2 的 http 通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.http-address.hdfscluster.nn2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop002:9870<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- nn3 的 http 通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.http-address.hdfscluster.nn3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop003:9870<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- nn4 的 http 通信地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.http-address.hdfscluster.nn4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop004:9870<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- NameNode 元数据在 JournalNode 上的共享存储目录 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.shared.edits.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>qjournal://hadoop001:8485;hadoop002:8485;hadoop003:8485;hadoop004:8485;hadoop005:8485;hadoop006:8485;hadoop007:8485/hdfscluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- Journal Edit Files 的存储目录 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.journalnode.edits.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/home/hadoop/journalnode/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 配置隔离机制，确保在任何给定时间只有一个 NameNode 处于活动状态 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.fencing.methods<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>sshfence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 使用 sshfence 机制时需要 ssh 免密登录 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.fencing.ssh.private-key-files<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/root/.ssh/id_rsa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 访问代理类，用于确定当前处于 Active 状态的 NameNode --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.client.failover.proxy.provider.hdfscluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 开启故障自动转移 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.automatic-failover.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>创建并分发 Journal Edit Files 的存储目录、namenode 节点数据(即元数据)的存放位置、datanode 节点数据(即数据块)的存放位置</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mkdir -p /home/hadoop/journalnode/data</span>
<span class="token comment" spellcheck="true"># mkdir -p /home/hadoop/namenode/data</span>
<span class="token comment" spellcheck="true"># mkdir -p /home/hadoop/datanode/data</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># scp -r /home/hadoop root@hadoop002</span>
<span class="token comment" spellcheck="true"># scp -r /home/hadoop root@hadoop003</span>
<span class="token comment" spellcheck="true"># scp -r /home/hadoop root@hadoop004</span>
<span class="token comment" spellcheck="true"># scp -r /home/hadoop root@hadoop005</span>
<span class="token comment" spellcheck="true"># scp -r /home/hadoop root@hadoop006</span>
<span class="token comment" spellcheck="true"># scp -r /home/hadoop root@hadoop007</span>
<span class="token comment" spellcheck="true"># scp -r /home/hadoop root@hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>${HADOOP_HOME}/etc/hadoop/yarn-site.xml</p></blockquote><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--配置 NodeManager 上运行的附属服务。需要配置成 mapreduce_shuffle 后才可以在 Yarn 上运行 MapReduce 程序。--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>mapreduce_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 是否启用日志聚合 (可选) --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.log-aggregation-enable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 聚合日志的保存时间 (可选) --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.log-aggregation.retain-seconds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>86400<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 启用 RM HA --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.ha.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM 集群标识 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.cluster-id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>yarncluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM 的逻辑 ID 列表 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.ha.rm-ids<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>rm1,rm2,rm3,rm4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM1 的服务地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.hostname.rm1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM2 的服务地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.hostname.rm2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop003<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM3 的服务地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.hostname.rm3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop004<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM4 的服务地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.hostname.rm4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop005<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM1 Web 应用程序的地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.webapp.address.rm1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop002:8088<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM2 Web 应用程序的地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.webapp.address.rm2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop003:8088<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM3 Web 应用程序的地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.webapp.address.rm3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop004:8088<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- RM4 Web 应用程序的地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.webapp.address.rm4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop005:8088<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- ZooKeeper 集群的地址 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.zk-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop001:2181,hadoop002:2181,hadoop003:2181,hadoop004:2181,hadoop005:2181<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 启用自动恢复 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.recovery.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- 用于进行持久化存储的类 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.store.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>${HADOOP_HOME}/etc/hadoop/mapred-site.xml</p></blockquote><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--指定 mapreduce 作业运行在 yarn 上--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>mapreduce.framework.name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>yarn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>${HADOOP_HOME}/etc/hadoop/workers</p></blockquote><pre><code>hadoop001
hadoop002
hadoop003
hadoop004
hadoop005
hadoop006
hadoop007
hadoop008</code></pre><h3 id="分发程序"><a href="#分发程序" class="headerlink" title="分发程序"></a>分发程序</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># scp -r /usr/local/hadoop hadoop002:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hadoop hadoop003:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hadoop hadoop004:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hadoop hadoop005:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hadoop hadoop006:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hadoop hadoop007:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hadoop hadoop008:/usr/local/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="启动集群-1"><a href="#启动集群-1" class="headerlink" title="启动集群"></a>启动集群</h3><blockquote><p>启动 JournalNode (所有 JournalNode)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># hdfs --daemon start journalnode</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>初始化 NameNode (hadoop001，主 NameNode)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># hdfs namenode -format</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>启动初始化后的 NameNode (hadoop001，主 NameNode)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># hdfs --daemon start namenode</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>同步 NameNode 信息 (其它 NameNode 节点，hadoop002、hadoop003、hadoop004)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># hdfs namenode -bootstrapStandby</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>初始化 HA 状态(任意一台 NameNode，hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># hdfs zkfc -formatZK</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>启动 HDFS(hadoop001，执行后所有节点的 NameNode 和 DataNode 都会启动)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># start-dfs.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><em>如果 DataNode 服务没有启动，一般是 clusterID 和 NameNode 不匹配的原因，修复方法是在 $HADOOP_HOME/logs/hadoop-root-datanode-hadoop001.log 的错误提示中找到 NameNode 的 clusterID 替换 /home/hadoop/datanode/data/current/VERSION 中的 clusterID 字段，然后分发此文件重启 dfs 即可。</em></p><blockquote><p>启动 YARN 集群(hadoop002，执行后所有节点的 ResourceManager 和 NodeManager 都会启动，若有的节点 ResourceManager 服务没有启动的话，需要使用 <code>yarn-daemon.sh start resourcemanager</code> 手动启动 )</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># start-yarn.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="HBase-高可用集群搭建"><a href="#HBase-高可用集群搭建" class="headerlink" title="HBase 高可用集群搭建"></a>HBase 高可用集群搭建</h2><h3 id="HBase-高可用集群规划"><a href="#HBase-高可用集群规划" class="headerlink" title="HBase 高可用集群规划"></a>HBase 高可用集群规划</h3><pre><code>hadoop001: Region Server
hadoop002: Region Server
hadoop003: Region Server
hadoop004: Region Server
hadoop005: Region Server
hadoop006: Region Server、备Master
hadoop007: Region Server、备Master
hadoop008: Region Server、主Master</code></pre><h3 id="HBase-主节点免密登录配置"><a href="#HBase-主节点免密登录配置" class="headerlink" title="HBase 主节点免密登录配置"></a>HBase 主节点免密登录配置</h3><blockquote><p>HMaster 主节点生成密钥(hadoop008)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh-keygen -t rsa</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>将 hadoop008 的公钥写到本机和远程机器的 ~/ .ssh/authorized_key 文件中(hadoop008)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop001</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop002</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop003</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop004</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop005</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop006</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop007</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>验证免密登录(hadoop008)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh hadoop001</span>
<span class="token comment" spellcheck="true"># ssh hadoop002</span>
<span class="token comment" spellcheck="true"># ssh hadoop003</span>
<span class="token comment" spellcheck="true"># ssh hadoop004</span>
<span class="token comment" spellcheck="true"># ssh hadoop005</span>
<span class="token comment" spellcheck="true"># ssh hadoop006</span>
<span class="token comment" spellcheck="true"># ssh hadoop007</span>
<span class="token comment" spellcheck="true"># ssh hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="解压安装-hadoop008"><a href="#解压安装-hadoop008" class="headerlink" title="解压安装(hadoop008)"></a>解压安装(hadoop008)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># tar zxvf hbase-2.2.5-bin.tar.gz -C /usr/local/</span>
<span class="token comment" spellcheck="true"># cd /usr/local</span>
<span class="token comment" spellcheck="true"># mv hbase-2.2.5 hbase</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="配置环境变量-所有-HBase-节点"><a href="#配置环境变量-所有-HBase-节点" class="headerlink" title="配置环境变量(所有 HBase 节点)"></a>配置环境变量(所有 HBase 节点)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># echo '</span>
<span class="token function">export</span> HBASE_HOME<span class="token operator">=</span>/usr/local/hbase
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$PATH</span><span class="token keyword">:</span><span class="token variable">$HBASE_HOME</span>/bin' <span class="token operator">>></span> /etc/profile
<span class="token comment" spellcheck="true"># source /etc/profile</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="配置-HBase-hadoop008"><a href="#配置-HBase-hadoop008" class="headerlink" title="配置 HBase (hadoop008)"></a>配置 HBase (hadoop008)</h3><blockquote><p>$HBASE_HOME/conf/hbase-env.sh</p></blockquote><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">export</span> <span class="token attr-value">JAVA_HOME=/usr/java/jdk1.8.0_261</span>
<span class="token attr-name">export</span> <span class="token attr-value">HBASE_MANAGES_ZK=false</span>
<span class="token attr-name">export</span> <span class="token attr-value">HBASE_CLASSPATH=/usr/local/hadoop/etc/hadoop</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>$HBASE_HOME/conf/hbase-site.xml</p></blockquote><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
  <span class="token comment" spellcheck="true">&lt;!--&lt;property>--></span>
    <span class="token comment" spellcheck="true">&lt;!-- 配置hbase的主节点 --></span>
  <span class="token comment" spellcheck="true">&lt;!--  &lt;name>hbase.master&lt;/name>--></span>
  <span class="token comment" spellcheck="true">&lt;!--  &lt;value>hadoop008:60000&lt;/value>--></span>
  <span class="token comment" spellcheck="true">&lt;!--&lt;/property>--></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 是否为集群模式：true --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.cluster.distributed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.tmp.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/usr/local/hbase/tmp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.unsafe.stream.capability.enforce<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 指定 zookeeper 的地址--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.zookeeper.quorum<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop001:2181,hadoop002:2181,hadoop003:2181,hadoop004:2181,hadoop005:2181<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 指定 hbase 在 HDFS 上的存储位置 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.rootdir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hdfs://hdfscluster:8020/hbase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 指定 hbase 主节点的端口 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.master.port<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>16000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 指定 hbase region server 的端口 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.regionserver.port<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>16020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 指定 hbase region server 的 web 端口 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.regionserver.info.port<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>16030<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hbase.zookeeper.property.dataDir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/usr/local/zookeeper/hbase/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>创建 HBase 临时文件存储目录及 ZK 数据存储目录</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mkdir -p /usr/local/hbase/tmp</span>
<span class="token comment" spellcheck="true"># mkdir -p /usr/local/zookeeper/hbase/data</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>regionservers</p></blockquote><pre><code>hadoop001
hadoop002
hadoop003
hadoop004
hadoop005
hadoop006
hadoop007
hadoop008</code></pre><blockquote><p>backup-masters</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># touch /usr/local/hbase/conf/backup-masters</span>
<span class="token comment" spellcheck="true"># echo 'hadoop006</span>
hadoop007' <span class="token operator">></span> /usr/local/hbase/conf/backup-masters<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="分发-HBase-hadoop008"><a href="#分发-HBase-hadoop008" class="headerlink" title="分发 HBase (hadoop008)"></a>分发 HBase (hadoop008)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># scp -r /usr/local/hbase hadoop001:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hbase hadoop002:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hbase hadoop003:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hbase hadoop004:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hbase hadoop005:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hbase hadoop006:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/hbase hadoop007:/usr/local/</span>

<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper/hbase hadoop001:/usr/local/zookeeper/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper/hbase hadoop002:/usr/local/zookeeper/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper/hbase hadoop003:/usr/local/zookeeper/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper/hbase hadoop004:/usr/local/zookeeper/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper/hbase hadoop005:/usr/local/zookeeper/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper/hbase hadoop006:/usr/local/zookeeper/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/zookeeper/hbase hadoop007:/usr/local/zookeeper/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="启动-HBase-集群-主节点HMaster-–-hadoop008"><a href="#启动-HBase-集群-主节点HMaster-–-hadoop008" class="headerlink" title="启动 HBase 集群 (主节点HMaster – hadoop008)"></a>启动 HBase 集群 (主节点HMaster – hadoop008)</h3><blockquote><p>主节点执行后会自动启动所有 RegionServer 及 所有HMaster 服务</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># start-hbase.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Kafka-高可用集群部署"><a href="#Kafka-高可用集群部署" class="headerlink" title="Kafka 高可用集群部署"></a>Kafka 高可用集群部署</h2><h3 id="Kafka-高可用集群规划"><a href="#Kafka-高可用集群规划" class="headerlink" title="Kafka 高可用集群规划"></a>Kafka 高可用集群规划</h3><pre><code>hadoop001: zookeeper、kafka、kafka-manager
hadoop002: zookeeper、kafka
hadoop003: zookeeper、kafka
hadoop004: zookeeper、kafka
hadoop005: zookeeper、kafka
hadoop006: 
hadoop007: 
hadoop008: </code></pre><h3 id="Kafka-主节点免密登录配置"><a href="#Kafka-主节点免密登录配置" class="headerlink" title="Kafka 主节点免密登录配置"></a>Kafka 主节点免密登录配置</h3><blockquote><p>Kafka 主节点生成密钥(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh-keygen -t rsa</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>将 hadoop001 的公钥写到本机和远程机器的 ~/ .ssh/authorized_key 文件中(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop001</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop002</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop003</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop004</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop005</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop006</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop007</span>
<span class="token comment" spellcheck="true"># ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>验证免密登录(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ssh hadoop001</span>
<span class="token comment" spellcheck="true"># ssh hadoop002</span>
<span class="token comment" spellcheck="true"># ssh hadoop003</span>
<span class="token comment" spellcheck="true"># ssh hadoop004</span>
<span class="token comment" spellcheck="true"># ssh hadoop005</span>
<span class="token comment" spellcheck="true"># ssh hadoop006</span>
<span class="token comment" spellcheck="true"># ssh hadoop007</span>
<span class="token comment" spellcheck="true"># ssh hadoop008</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="解压安装-hadoop001-1"><a href="#解压安装-hadoop001-1" class="headerlink" title="解压安装(hadoop001)"></a>解压安装(hadoop001)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># tar zxvf kafka_2.13-2.6.0.tgz -C /usr/local/</span>
<span class="token comment" spellcheck="true"># cd /usr/local</span>
<span class="token comment" spellcheck="true"># mv kafka_2.13-2.6.0 kafka</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="配置环境变量-所有-Kafka-节点"><a href="#配置环境变量-所有-Kafka-节点" class="headerlink" title="配置环境变量(所有 Kafka 节点)"></a>配置环境变量(所有 Kafka 节点)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># echo '</span>
<span class="token function">export</span> KAFKA_HOME<span class="token operator">=</span>/usr/local/kafka
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$KAFKA_HOME</span>/bin:<span class="token variable">$PATH</span>' <span class="token operator">>></span> /etc/profile
<span class="token comment" spellcheck="true"># source /etc/profile</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="配置-Kafka-hadoop001"><a href="#配置-Kafka-hadoop001" class="headerlink" title="配置 Kafka (hadoop001)"></a>配置 Kafka (hadoop001)</h3><blockquote><p>$KAFKA_HOME/conf/server.properties</p></blockquote><pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># 对应 ZK 的 myid，集群中每个节点的唯一标识</span>
<span class="token attr-name">broker.id</span><span class="token punctuation">=</span><span class="token attr-value">1</span>
<span class="token comment" spellcheck="true"># 监听地址</span>
<span class="token attr-name">listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop001:9092</span>
<span class="token attr-name">advertised.listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop001:9092</span>
<span class="token comment" spellcheck="true"># 数据的存储位置</span>
<span class="token attr-name">log.dirs</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/kafka/logs</span>
<span class="token comment" spellcheck="true"># Zookeeper连接地址</span>
<span class="token attr-name">zookeeper.connect</span><span class="token punctuation">=</span><span class="token attr-value">hadoop001:2181,hadoop002:2181,hadoop003:2181,hadoop004:2181,hadoop005:2181</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>创建日志存储目录</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mkdir /usr/local/kafka/logs</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>分发 kafka 到各个节点(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># scp -r kafka hadoop002:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r kafka hadoop003:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r kafka hadoop004:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r kafka hadoop005:/usr/local/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>修改分发节点的 Kafka 配置文件 – $KAFKA_HOME/conf/server.properties(hadoop002-005)</p></blockquote><blockquote><p>hadoop002</p></blockquote><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">broker.id</span><span class="token punctuation">=</span><span class="token attr-value">2</span>
<span class="token attr-name">listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop002:9092</span>
<span class="token attr-name">advertised.listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop002:9092</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>hadoop003</p></blockquote><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">broker.id</span><span class="token punctuation">=</span><span class="token attr-value">3</span>
<span class="token attr-name">listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop003:9092</span>
<span class="token attr-name">advertised.listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop003:9092</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>hadoop004</p></blockquote><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">broker.id</span><span class="token punctuation">=</span><span class="token attr-value">4</span>
<span class="token attr-name">listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop004:9092</span>
<span class="token attr-name">advertised.listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop004:9092</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>hadoop005</p></blockquote><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">broker.id</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
<span class="token attr-name">listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop005:9092</span>
<span class="token attr-name">advertised.listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://hadoop005:9092</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="启动-Kafka-集群-所有-Kafka-节点"><a href="#启动-Kafka-集群-所有-Kafka-节点" class="headerlink" title="启动 Kafka 集群(所有 Kafka 节点)"></a>启动 Kafka 集群(所有 Kafka 节点)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># kafka-server-start.sh -daemon /usr/local/kafka/config/server.properties</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Flink-高可用集群部署"><a href="#Flink-高可用集群部署" class="headerlink" title="Flink 高可用集群部署"></a>Flink 高可用集群部署</h2><h3 id="Flink-高可用集群规划"><a href="#Flink-高可用集群规划" class="headerlink" title="Flink 高可用集群规划"></a>Flink 高可用集群规划</h3><pre><code>hadoop001: zookeeper、主 JobManager
hadoop002: zookeeper、备 JobManager
hadoop003: zookeeper、备 JobManager
hadoop004: zookeeper、备 JobManager
hadoop005: zookeeper、TaskManager
hadoop006: TaskManager
hadoop007: TaskManager
hadoop008: TaskManager</code></pre><h3 id="解压安装-hadoop001-2"><a href="#解压安装-hadoop001-2" class="headerlink" title="解压安装(hadoop001)"></a>解压安装(hadoop001)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># tar zxvf flink-1.11.2-bin-scala_2.12.tgz -C /usr/local/</span>
<span class="token comment" spellcheck="true"># cd /usr/local</span>
<span class="token comment" spellcheck="true"># mv flink-1.11.2 flink</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="配置环境变量-所有-Flink-节点"><a href="#配置环境变量-所有-Flink-节点" class="headerlink" title="配置环境变量(所有 Flink 节点)"></a>配置环境变量(所有 Flink 节点)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># echo '</span>
<span class="token function">export</span> FLINK_HOME<span class="token operator">=</span>/usr/local/flink
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$FLINK_HOME</span>/bin:<span class="token variable">$PATH</span>' <span class="token operator">>></span> /etc/profile
<span class="token comment" spellcheck="true"># source /etc/profile</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="配置-Flink-hadoop001"><a href="#配置-Flink-hadoop001" class="headerlink" title="配置 Flink (hadoop001)"></a>配置 Flink (hadoop001)</h3><blockquote><p>${FLINK_HOME}/conf/flink-conf.yaml</p></blockquote><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">high-availability</span><span class="token punctuation">:</span> zookeeper
<span class="token key atrule">high-availability.zookeeper.quorum</span><span class="token punctuation">:</span> hadoop001<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>hadoop002<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>hadoop003<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>hadoop004<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>hadoop005<span class="token punctuation">:</span><span class="token number">2181</span>
<span class="token key atrule">high-availability.zookeeper.path.root</span><span class="token punctuation">:</span> /flink
<span class="token key atrule">high-availability.cluster-id</span><span class="token punctuation">:</span> /flinkcluster
<span class="token key atrule">high-availability.storageDir</span><span class="token punctuation">:</span> hdfs<span class="token punctuation">:</span>///flink/recovery
<span class="token comment" spellcheck="true"># high-availability.storageDir: hdfs://hdfscluster:8020/flink/recovery</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>${FLINK_HOME}/conf/masters</p></blockquote><pre><code>hadoop001:8081
hadoop002:8081
hadoop003:8081
hadoop004:8081</code></pre><blockquote><p>${FLINK_HOME}/conf/workers</p></blockquote><pre><code>hadoop005
hadoop006
hadoop007
hadoop008</code></pre><h3 id="分发-Flink-hadoop001"><a href="#分发-Flink-hadoop001" class="headerlink" title="分发 Flink (hadoop001)"></a>分发 Flink (hadoop001)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># scp -r /usr/local/flink hadoop002:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/flink hadoop003:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/flink hadoop004:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/flink hadoop005:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/flink hadoop006:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/flink hadoop007:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/flink hadoop008:/usr/local/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="启动-Flink-集群"><a href="#启动-Flink-集群" class="headerlink" title="启动 Flink 集群"></a>启动 Flink 集群</h3><blockquote><p>启动 ZooKeeper 集群(所有 ZK 节点)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># zkServer.sh start</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>启动 Hadoop 集群(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## 启动 dfs 高可用</span>
<span class="token comment" spellcheck="true"># start-dfs.sh</span>
<span class="token comment" spellcheck="true">## 启动 yarn 高可用</span>
<span class="token comment" spellcheck="true"># start-yarn.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>启动 Flink 集群(hadoop001)</p></blockquote><pre><code># /usr/local/flink/bin/start-cluster.sh</code></pre><p><em>Flink 启动常见错误</em></p><pre><code>Caused by: org.apache.flink.core.fs.UnsupportedFileSystemSchemeException: Hadoop is not in 
the classpath/dependencies.</code></pre><p><em>是因为在 classpath 目录下找不到 Hadoop 的相关依赖，从下面地址下载对应 <code>hadoop</code> 版本的 <code>flink-shaded-hadoop-3-uber</code> 的 <code>jar</code> 包，拷贝到所有 <code>Flink</code> 的 <code>${FLINK_HOME}/lib</code> 目录中重启 <code>Flink</code> 即可，测试发现 <code>3.2.1</code> 的 <code>Hadoop</code> 可以使用 <code>3.1.1</code> 的依赖包。</em></p><pre><code>https://repository.cloudera.com/artifactory/libs-release-local/org/apache/flink/flink-shaded-hadoop-3-uber/</code></pre><h2 id="Spark-高可用集群部署"><a href="#Spark-高可用集群部署" class="headerlink" title="Spark 高可用集群部署"></a>Spark 高可用集群部署</h2><h3 id="Spark-高可用集群规划"><a href="#Spark-高可用集群规划" class="headerlink" title="Spark 高可用集群规划"></a>Spark 高可用集群规划</h3><pre><code>hadoop001: zookeeper、主spark master、spark worker
hadoop002: zookeeper、备spark master、spark worker
hadoop003: zookeeper、备spark master、spark worker
hadoop004: zookeeper、备spark master、spark worker
hadoop005: zookeeper、spark worker
hadoop006: spark worker
hadoop007: spark worker
hadoop008: spark worker</code></pre><h3 id="解压安装-hadoop001-3"><a href="#解压安装-hadoop001-3" class="headerlink" title="解压安装(hadoop001)"></a>解压安装(hadoop001)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># tar zxvf spark-3.0.1-bin-hadoop3.2.tgz -C /usr/local/</span>
<span class="token comment" spellcheck="true"># cd /usr/local</span>
<span class="token comment" spellcheck="true"># mv spark-3.0.1-bin-hadoop3.2 spark</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="配置环境变量-所有-Spark-节点"><a href="#配置环境变量-所有-Spark-节点" class="headerlink" title="配置环境变量(所有 Spark 节点)"></a>配置环境变量(所有 Spark 节点)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># echo '</span>
<span class="token function">export</span> SPARK_HOME<span class="token operator">=</span>/usr/local/spark
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$SPARK_HOME</span>/bin:<span class="token variable">$SPARK_HOME</span>/sbin:<span class="token variable">$PATH</span>' <span class="token operator">>></span> /etc/profile
<span class="token comment" spellcheck="true"># source /etc/profile</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="配置-Spark-hadoop001"><a href="#配置-Spark-hadoop001" class="headerlink" title="配置 Spark (hadoop001)"></a>配置 Spark (hadoop001)</h3><blockquote><p>${SPARK_HOME}/conf/spark-env.sh</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash">JAVA_HOME<span class="token operator">=</span>/usr/java/jdk1.8.0_261
HADOOP_CONF_DIR<span class="token operator">=</span>/usr/local/hadoop/etc/hadoop
SPARK_DAEMON_JAVA_OPTS<span class="token operator">=</span><span class="token string">"-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=hadoop001:2181,hadoop002:2181,hadoop003:2181,hadoop004:2181,hadoop005:2181 -Dspark.deploy.zookeeper.dir=/spark"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>${SPARK_HOME}/conf/slaves – 配置所有 Worker 节点列表</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cp /usr/local/spark/conf/slaves.template /usr/local/spark/conf/slaves</span>
<span class="token comment" spellcheck="true"># echo 'hadoop001</span>
hadoop002
hadoop003
hadoop004
hadoop005
hadoop006
hadoop007
hadoop008' <span class="token operator">></span> /usr/local/spark/conf/slaves<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="分发-Spark"><a href="#分发-Spark" class="headerlink" title="分发 Spark"></a>分发 Spark</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># scp -r /usr/local/spark hadoop002:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/spark hadoop003:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/spark hadoop004:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/spark hadoop005:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/spark hadoop006:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/spark hadoop007:/usr/local/</span>
<span class="token comment" spellcheck="true"># scp -r /usr/local/spark hadoop008:/usr/local/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="启动-Spark-集群"><a href="#启动-Spark-集群" class="headerlink" title="启动 Spark 集群"></a>启动 Spark 集群</h3><blockquote><p>启动 ZooKeeper 集群(所有 ZK 节点)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># zkServer.sh start</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>启动 Hadoop 集群(hadoop001)</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## 启动 dfs 高可用</span>
<span class="token comment" spellcheck="true"># start-dfs.sh</span>
<span class="token comment" spellcheck="true">## 启动 yarn 高可用</span>
<span class="token comment" spellcheck="true"># start-yarn.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>启动 Spark 集群</p></blockquote><pre><code>## 启动所有的 worker 和 主 master -- hadoop001
# /usr/local/spark/sbin/start-all.sh
## 分别到所有备 master 节点启动所有的备 master -- hadoop001-004
# /usr/local/spark/sbin/start-master.sh</code></pre><h3 id="验证集群高可用"><a href="#验证集群高可用" class="headerlink" title="验证集群高可用"></a>验证集群高可用</h3><p>使用 <code>kill</code> 命令杀死 <code>hadoop001</code> 的 <code>Master</code> 进程，此时备用 <code>Master</code> 进程中会有一个成为 <code>主 Master</code>，再次启动 <code>hadoop001</code> 的 <code>Master</code> 服务，其会作为 <code>备 Master</code> 存在。</p><h2 id="集群启停顺序"><a href="#集群启停顺序" class="headerlink" title="集群启停顺序"></a>集群启停顺序</h2><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><blockquote><p>ZooKeeper -&gt; Hadoop(DFS) -&gt; Yarn -&gt; HBase -&gt; Spark Master -&gt; Spark Worker -&gt; Kafka -&gt; Flink</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## ZK 服务需要在每个 ZK 节点执行</span>
<span class="token comment" spellcheck="true"># zkServer.sh start</span>
<span class="token comment" spellcheck="true">## Hadoop 主节点(hadoop001)</span>
<span class="token comment" spellcheck="true"># start-dfs.sh</span>
<span class="token comment" spellcheck="true">## Yarn 主节点(hadoop002或hadoop001)</span>
<span class="token comment" spellcheck="true"># start-yarn.sh</span>
<span class="token comment" spellcheck="true">## HBase 主节点(hadoop008)</span>
<span class="token comment" spellcheck="true"># start-hbase.sh</span>
<span class="token comment" spellcheck="true">## Spark 主节点(hadoop001)</span>
<span class="token comment" spellcheck="true"># /usr/local/spark/sbin/start-all.sh</span>
<span class="token comment" spellcheck="true">## Spark Worker 节点(hadoop001-004)</span>
<span class="token comment" spellcheck="true"># /usr/local/spark/sbin/start-master.sh</span>
<span class="token comment" spellcheck="true">## Kafka 服务需要在每个 Kafka 节点执行</span>
<span class="token comment" spellcheck="true"># kafka-server-start.sh -daemon /usr/local/kafka/config/server.properties</span>
<span class="token comment" spellcheck="true">## Flink 主节点(hadoop001)</span>
<span class="token comment" spellcheck="true"># /usr/local/flink/bin/start-cluster.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h3><blockquote><p>Flink -&gt; Kafka -&gt; Spark Worker -&gt; Spark Master -&gt; HBase -&gt; Yarn -&gt; Hadoop(DFS) -&gt; ZooKeeper</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## Flink 主节点(hadoop001)</span>
<span class="token comment" spellcheck="true"># /usr/local/flink/bin/stop-cluster.sh</span>
<span class="token comment" spellcheck="true">## Kafka 服务需要在每个 Kafka 节点执行</span>
<span class="token comment" spellcheck="true"># kafka-server-stop.sh</span>
<span class="token comment" spellcheck="true">## Spark Worker 节点(hadoop001-004)</span>
<span class="token comment" spellcheck="true"># /usr/local/spark/sbin/stop-master.sh</span>
<span class="token comment" spellcheck="true">## Spark 主节点(hadoop001)</span>
<span class="token comment" spellcheck="true"># /usr/local/spark/sbin/stop-all.sh</span>
<span class="token comment" spellcheck="true">## HBase 主节点(hadoop008)</span>
<span class="token comment" spellcheck="true"># stop-hbase.sh</span>
<span class="token comment" spellcheck="true">## Yarn 主节点(hadoop002)</span>
<span class="token comment" spellcheck="true"># stop-yarn.sh</span>
<span class="token comment" spellcheck="true">## Hadoop 主节点(hadoop001)</span>
<span class="token comment" spellcheck="true"># stop-dfs.sh</span>
<span class="token comment" spellcheck="true">## ZK 服务需要在每个 ZK 节点执行</span>
<span class="token comment" spellcheck="true"># zkServer.sh stop</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Hadoop-生态圈常用组件-WebUI"><a href="#Hadoop-生态圈常用组件-WebUI" class="headerlink" title="Hadoop 生态圈常用组件 WebUI"></a>Hadoop 生态圈常用组件 WebUI</h2><table><thead><tr><th>服务</th><th>端口</th></tr></thead><tbody><tr><td>Hadoop</td><td>8042</td></tr><tr><td>Hadoop HDFS NameNode</td><td>9870</td></tr><tr><td>Hadoop HDFS DataNode</td><td>9864</td></tr><tr><td>Yarn JournalNode</td><td>8480</td></tr><tr><td>Yarn ResourceManager</td><td>8088</td></tr><tr><td>HBase Master</td><td>16010</td></tr><tr><td>HBase RegionServer</td><td>16030</td></tr><tr><td>Spark Master</td><td>8082</td></tr><tr><td>Spark Worker</td><td>8083</td></tr><tr><td>Kafka(非 Web 端口)</td><td>9092</td></tr><tr><td>Flink</td><td>8081</td></tr><tr><td>ZooKeeper(非 Web 端口)</td><td>2181</td></tr></tbody></table></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="https://blog.tlhub.cn" rel="external nofollow noreferrer">套陆</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://blog.tlhub.cn/CentOS-depoly-8-nodes-Hadoop-HBase-Kafka-Flink-Spark-Zookeeper-HA-Cluster.html">https://blog.tlhub.cn/CentOS-depoly-8-nodes-Hadoop-HBase-Kafka-Flink-Spark-Zookeeper-HA-Cluster.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tlhub.cn" target="_blank">套陆</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Hadoop/"><span class="chip bg-color">Hadoop</span></a> <a href="/tags/HBase/"><span class="chip bg-color">HBase</span></a> <a href="/tags/Kafka/"><span class="chip bg-color">Kafka</span></a> <a href="/tags/Flink/"><span class="chip bg-color">Flink</span></a> <a href="/tags/Spark/"><span class="chip bg-color">Spark</span></a> <a href="/tags/Zookeeper/"><span class="chip bg-color">Zookeeper</span></a> <a href="/tags/HDFS/"><span class="chip bg-color">HDFS</span></a> <a href="/tags/BigData/"><span class="chip bg-color">BigData</span></a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="chip bg-color">大数据</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/medias/reward/wechatpay.jpg" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/gitalk/gitalk.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/css/my-gitalk.css"><div class="card gitalk-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="gitalk-container" class="card-content"></div></div><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/gitalk/gitalk.min.js"></script><script>let gitalk = new Gitalk({
        clientID: 'ae84231acb9f9d755d64',
        clientSecret: '999406dd97c504a700abe350a711868e1000fcec',
        repo: 'athlonreg.github.io',
        owner: 'athlonreg',
        admin: "athlonreg",
        id: '2020-10-03T09-06-12',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="far fa-dot-circle"></i> &nbsp;本篇</div><div class="card"><a href="/CentOS-depoly-8-nodes-Hadoop-HBase-Kafka-Flink-Spark-Zookeeper-HA-Cluster.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/tlhub/1/hadoop.jpg" class="responsive-img" alt="CentOS 搭建八节点高可用 Hadoop HBase Kafka Flink Spark Zookeeper 集群"> <span class="card-title">CentOS 搭建八节点高可用 Hadoop HBase Kafka Flink Spark Zookeeper 集群</span></div></a><div class="card-content article-content"><div class="summary block-with-text">CentOS 搭建八节点高可用 Hadoop HBase Kafka Flink Spark Zookeeper 集群</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-10-03</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Linux/" class="post-category">Linux</a></span></div></div><div class="card-action article-tags"><a href="/tags/Hadoop/"><span class="chip bg-color">Hadoop</span></a> <a href="/tags/HBase/"><span class="chip bg-color">HBase</span></a> <a href="/tags/Kafka/"><span class="chip bg-color">Kafka</span></a> <a href="/tags/Flink/"><span class="chip bg-color">Flink</span></a> <a href="/tags/Spark/"><span class="chip bg-color">Spark</span></a> <a href="/tags/Zookeeper/"><span class="chip bg-color">Zookeeper</span></a> <a href="/tags/HDFS/"><span class="chip bg-color">HDFS</span></a> <a href="/tags/BigData/"><span class="chip bg-color">BigData</span></a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="chip bg-color">大数据</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/How-to-deploy-MySQL-8-0-on-CentOS.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/medias/featureimages/2.jpg" class="responsive-img" alt="CentOS 安装部署 MySQL 8.0"> <span class="card-title">CentOS 安装部署 MySQL 8.0</span></div></a><div class="card-content article-content"><div class="summary block-with-text">CentOS 安装部署 MySQL 8.0</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-09-12</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Linux/" class="post-category">Linux</a></span></div></div><div class="card-action article-tags"><a href="/tags/MySQL/"><span class="chip bg-color">MySQL</span></a> <a href="/tags/8/"><span class="chip bg-color">8</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){if(void 0!==window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("60"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"===n.getRangeAt(0).commonAncestorContainer.nodeName&&(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: 套陆的部落阁<br />文章作者: 套陆<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)}}})</script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/codeBlock/codeBlockFuction.js"></script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/codeBlock/codeLang.js"></script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/codeBlock/codeCopy.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/aplayer/APlayer.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#b7daff}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div><div class="row"><meting-js class="col l8 offset-l2 m10 offset-m1 s12" server="netease" type="playlist" id="327690691" fixed="true" autoplay theme="#b7daff" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js></div></div><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/aplayer/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><div class="container row center-align" style="margin-bottom:0!important"><div class="col s12 m8 l8 copy-right"><span id="icp"><img src="https://cdn.jsdelivr.net/gh/tlhub/1/gabico.png" style="vertical-align:text-bottom"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11011302002019" rel="external nofollow noreferrer" target="_blank">京公网安备 11011302002019号</a> &nbsp;|&nbsp; <a href="http://www.beian.miit.gov.cn/" rel="external nofollow noreferrer" target="_blank">京ICP备20017043号-1</a></span><br>Copyright&nbsp;&copy; <span id="year">2017</span> <a href="/about" target="_blank">套陆</a> | CDN BY &nbsp;<a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" rel="external nofollow noreferrer"><img src="https://cdn.jsdelivr.net/gh/tlhub/picbed-1/又拍云_logo6.png" style="height:25px;margin-bottom:-6px"></a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">123.3k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次</span> <span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><script>$(document).ready(function(){var e=setInterval(function(){"none"!=document.getElementById("busuanzi_container_site_pv").style.display&&($("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html())+n),clearInterval(e));"none"!=$("#busuanzi_container_site_pv").css("display")&&($("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html())+n),clearInterval(e))},50),n=2e5})</script></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/athlonreg" rel="external nofollow noreferrer" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:1143991340@qq.com" rel="external nofollow noreferrer" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1143991340" rel="external nofollow noreferrer" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1143991340" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div><br></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,a,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),r=document.getElementById(a),n=document.getElementById(s);r.addEventListener("input",function(){var f='<ul class="search-result-list">',m=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var r=!0,n=t.title.trim().toLowerCase(),a=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),e=t.url;e=0===e.indexOf("/")?t.url:"/"+e;var s=-1,i=-1,l=-1;if(""!==n&&""!==a&&m.forEach(function(t,e){s=n.indexOf(t),i=a.indexOf(t),s<0&&i<0?r=!1:(i<0&&(i=0),0===e&&(l=i))}),r){f+="<li><a href='"+e+"' class='search-result-title'>"+n+"</a>";var c=t.content.trim().replace(/<[^>]+>/g,"");if(0<=l){var u=l-20,o=l+80;u<0&&(u=0),0===u&&(o=100),o>c.length&&(o=c.length);var h=c.substr(u,o);m.forEach(function(t){var e=new RegExp(t,"gi");h=h.replace(e,'<em class="search-keyword">'+t+"</em>")}),f+='<p class="search-result">'+h+"...</p>"}f+="</li>"}}),f+="</ul>",n.innerHTML=f)})}})}("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/materialize/materialize.min.js"></script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/masonry/masonry.pkgd.min.js"></script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/aos/aos.js"></script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/js/matery.js"></script><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/others/clicklove.js" async></script><script async src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/others/busuanzi.pure.mini.js"></script><div style="position:fixed;bottom:123px;right:18px;cursor:pointer"><a title="兔小巢" href="https://support.qq.com/products/295883" target="_blank" rel="noopener external nofollow noreferrer"><img src="/medias/contact.png"></a></div><script src="https://cdn.jsdelivr.net/gh/athlonreg/athlonreg.github.io/libs/instantpage/instantpage.js" type="module"></script></body></html>